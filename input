.fileinput.s
.intel_syntax noprefix
.globl _start
.data
  "<0": .string "12"
  _2: .string "1"
.bss
.lcomm EMSG, 512
.lcomm STDO, 8
.lcomm STDE, 8
.lcomm STDI, 8
  .lcomm _3, 8
.text
_start:
push rbp
mov rbp, rsp
sub rsp, 32
mov ecx, 65001
call SetConsoleCP
test rax, rax
jz display_error
mov ecx, 65001
call SetConsoleOutputCP
test rax, rax
jz display_error
mov ecx, -10
call GetStdHandle
cmp rax, -1
je display_error
mov QWORD PTR STDI[rip], rax
mov ecx, -11
call GetStdHandle
cmp rax, -1
je display_error
mov QWORD PTR STDO[rip], rax
mov ecx, -12
call GetStdHandle
cmp rax, -1
je display_error
mov QWORD PTR STDE[rip], rax
call _1
  xor ecx, ecx
call ExitProcess
display_error:
call GetLastError
mov rbx, rax
sub rsp, 32
mov ecx, 0x1200
xor edx, edx
mov r8, rbx
xor r9d, r9d
lea rax, QWORD PTR EMSG[rip]
mov 32[rsp], rax
mov QWORD PTR 40[rsp], 512
mov QWORD PTR 48[rsp], 0
call FormatMessageW
add rsp, 32
test rax, rax
jz exit_program
xor ecx, ecx
lea rdx, QWORD PTR EMSG[rip]
xor r8d, r8d
mov r9, 0x10
call MessageBoxW
exit_program:
mov rcx, rbx
call ExitProcess
_1:
  push rbp
  mov rbp, rsp
  sub rsp, 32
  xor ecx, ecx
  lea rdx, QWORD PTR _2[rip]
  lea r8, QWORD PTR "<0"[rip]
  xor r9d, r9d
  call MessageBoxA
  test eax, eax
  jz display_error
  mov QWORD PTR _3[rip], rax
  add rsp, 32
  mov rsp, rbp
  pop rbp
  ret
